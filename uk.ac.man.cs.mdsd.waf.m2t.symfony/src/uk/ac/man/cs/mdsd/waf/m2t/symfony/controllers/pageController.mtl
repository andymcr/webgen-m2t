[comment encoding = UTF-8 /]
[module pageController(
	'http://www.cs.man.ac.uk/mdsd/2015/WebApplicationFramework')]
[import uk::ac::man::cs::mdsd::waf::m2t::core::featureProperties/]
[import uk::ac::man::cs::mdsd::waf::m2t::core::files/]
[import uk::ac::man::cs::mdsd::waf::m2t::symfony::files/]
[import uk::ac::man::cs::mdsd::waf::m2t::symfony::names/]
[import uk::ac::man::cs::mdsd::waf::m2t::symfony::controllers::authenticationMethods/]
[import uk::ac::man::cs::mdsd::waf::m2t::symfony::controllers::detailsMethods/]
[import uk::ac::man::cs::mdsd::waf::m2t::symfony::controllers::editMethods/]
[import uk::ac::man::cs::mdsd::waf::m2t::symfony::controllers::indexMethods/]
[comment import uk::ac::man::cs::mdsd::jsf::m2t::symfony::files::controllers::searchMethods/]
[comment import uk::ac::man::cs::mdsd::jsf::m2t::symfony::files::controllers::staticMethods/]


[template public generateController(page : Page)]
[file(page.controllerFilename(), false)]
<?php
namespace [page.controllersNamespace()/];

[for (service : Service | page.editUnits().service->asSet())]
use [service.modelsNamespace()/]\[service.modelName()/];
[/for]
[for (service : Service | page.formUnits().service->asSet())]
use [service.formTypeNamespace()/]\[service.typeClassName()/];
[/for]
use Sensio\Bundle\FrameworkExtraBundle\Configuration\Route;
use Symfony\Bundle\FrameworkBundle\Controller\Controller;
[if (page.hasFilterParameters())]
use Symfony\Component\HttpFoundation\Request;
[/if]


class [page.controllerClassName()/] extends [page.baseControllerClassName()/]
{
[for (unit : ContentUnit | page.units)]
    [unit.unitMethods()/]

[/for]
[for (service : Service | page.dynamicUnits()->collect(u | u.service)->asSet())]
    [service.getServiceMethod()/]

[/for]
[if (page.hasSupportActions())]
	[if (page.hasDataSupportActions())]
    public function action_support()
    {
	[for (action : UnitSupportAction | page.dataSupportActions())]
		if ($this->request->post('[action.name/]'))
		{
			// [protected ('support.'.concat(action.name))]
			// [/protected]
		}
	[/for]
	}

	[/if]
	/* [protected (page.instanceName().concat('.support.'))]
	 */
	/* [/protected]
	 */
[/if]
[if (page.units->size() > 1)]

    [page.renderMethod()/]
[/if]
}
[/file]
[/template]

[template public getServiceMethod(service : Service) post(trim())]
public function get[service.modelName()/]Service()
{
    return $this->get('[service.name/]');
}
[/template]

[template renderMethod(page : Page) post(trim())]
private function renderPage([if (page.hasFilterParameters())]Request $request[/if])
{
    $parameters = array(
        'title' => '[page.displayLabel/]',
    );
[for (unit : ContentUnit | page.units)]
    [unit.templateParameters()/]
[/for]
    return $this->render('[page.name/]/page[page.htmlExtension()/][page.twigExtension()/]', $parameters);

}
[/template]